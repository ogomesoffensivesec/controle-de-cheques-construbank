import{c as xe,a1 as pe,i as je,r as v,X as fe,j as e,B as N,L as u,I as p,Y as ge,Z as ve,_ as Ce,$ as Ne,a8 as z,e as F,a9 as ye,q as M,t as B,v as V,w as Y,ab as A,ac as k,T as L,d as Re,a0 as De}from"./index-1L3QXtjl.js";import{Q as qe,B as C}from"./ReactToastify-CoRJ3_DZ.js";import{T as be,a as we,b as Z,c as R,d as Fe,e as D}from"./table-BI1FEwuE.js";import{D as H,f as W,a as _,b as J,c as Q,d as X}from"./dialog-RUAiv4Cq.js";import{S as Te}from"./scroll-area-DxNCeqEf.js";import{S as Se,a as Pe,b as ze,c as Ae,d as Le,e as Ie,T as Oe}from"./cheques-BKTdtoZw.js";import{v as G,P as ke}from"./v4-ty9w4GEH.js";import{t as K,o as se,p as re,c as Ue,k as ee}from"./format-CphUbbWy.js";import"./check-7Du4jFlM.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=xe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function ae(o,r){const s=()=>Ue(r==null?void 0:r.in,NaN),i=Ve(o);let m;if(i.date){const h=Ye(i.date,2);m=Ze(h.restDateString,h.year)}if(!m||isNaN(+m))return s();const f=+m;let j=0,g;if(i.time&&(j=He(i.time),isNaN(j)))return s();if(i.timezone){if(g=We(i.timezone),isNaN(g))return s()}else{const h=new Date(f+j),y=K(0,r==null?void 0:r.in);return y.setFullYear(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate()),y.setHours(h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds()),y}return K(f+j+g,r==null?void 0:r.in)}const I={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ee=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Me=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Be=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ve(o){const r={},s=o.split(I.dateTimeDelimiter);let n;if(s.length>2)return r;if(/:/.test(s[0])?n=s[0]:(r.date=s[0],n=s[1],I.timeZoneDelimiter.test(r.date)&&(r.date=o.split(I.timeZoneDelimiter)[0],n=o.substr(r.date.length,o.length))),n){const i=I.timezone.exec(n);i?(r.time=n.replace(i[1],""),r.timezone=i[1]):r.time=n}return r}function Ye(o,r){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),n=o.match(s);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,m=n[2]?parseInt(n[2]):null;return{year:m===null?i:m*100,restDateString:o.slice((n[1]||n[2]).length)}}function Ze(o,r){if(r===null)return new Date(NaN);const s=o.match(Ee);if(!s)return new Date(NaN);const n=!!s[4],i=T(s[1]),m=T(s[2])-1,f=T(s[3]),j=T(s[4]),g=T(s[5])-1;if(n)return Ge(r,j,g)?_e(r,j,g):new Date(NaN);{const h=new Date(0);return!Qe(r,m,f)||!Xe(r,i)?new Date(NaN):(h.setUTCFullYear(r,m,Math.max(i,f)),h)}}function T(o){return o?parseInt(o):1}function He(o){const r=o.match(Me);if(!r)return NaN;const s=U(r[1]),n=U(r[2]),i=U(r[3]);return Ke(s,n,i)?s*se+n*re+i*1e3:NaN}function U(o){return o&&parseFloat(o.replace(",","."))||0}function We(o){if(o==="Z")return 0;const r=o.match(Be);if(!r)return 0;const s=r[1]==="+"?-1:1,n=parseInt(r[2]),i=r[3]&&parseInt(r[3])||0;return ea(n,i)?s*(n*se+i*re):NaN}function _e(o,r,s){const n=new Date(0);n.setUTCFullYear(o,0,4);const i=n.getUTCDay()||7,m=(r-1)*7+s+1-i;return n.setUTCDate(n.getUTCDate()+m),n}const Je=[31,null,31,30,31,30,31,31,30,31,30,31];function te(o){return o%400===0||o%4===0&&o%100!==0}function Qe(o,r,s){return r>=0&&r<=11&&s>=1&&s<=(Je[r]||(te(o)?29:28))}function Xe(o,r){return r>=1&&r<=(te(o)?366:365)}function Ge(o,r,s){return r>=1&&r<=53&&s>=0&&s<=6}function Ke(o,r,s){return o===24?r===0&&s===0:s>=0&&s<60&&r>=0&&r<60&&o>=0&&o<25}function ea(o,r){return r>=0&&r<=59}const da=()=>{const{id:o}=pe(),r=je(),[s,n]=v.useState(null),[i,m]=v.useState(!0),[f,j]=v.useState(!1),[g,h]=v.useState(null),[y,oe]=v.useState(""),{currentUser:d}=fe(),[w,S]=v.useState([]),[l,O]=v.useState({id:G(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[]}),[$,E]=v.useState(!1);v.useEffect(()=>{(async()=>{if(o){m(!0);try{const t=z(F,"remessas",o),c=await ye(t);c.exists()?n({id:c.id,...c.data()}):C.error("Remessa não encontrada.")}catch(t){console.error("Erro ao buscar remessa:",t),C.error("Ocorreu um erro ao buscar a remessa.")}finally{m(!1)}}})()},[o]);const ne=async()=>{if(!(!s||!s.id)){if(!g||!y){C.error("Por favor, preencha todos os campos.");return}j(!0);try{const a=M(B,`remessas/${s.id}/${g.name}`);await V(a,g);const t=await Y(a),c=z(F,"remessas",s.id);await A(c,{documentoAssinadoUrl:t,recebidoPor:y,status:"Finalizada",log:k({timestamp:L.now(),message:"Remessa finalizada",user:(d==null?void 0:d.displayName)||(d==null?void 0:d.email)||"Usuário desconhecido"})});for(const q of s.cheques){const b=z(F,"cheques",q.id);await A(b,{local:"Destino Final",log:k({timestamp:L.now(),message:`Remessa ${s.protocolo} finalizada`,user:(d==null?void 0:d.displayName)||(d==null?void 0:d.email)||"Usuário desconhecido"})})}C.success("Remessa finalizada com sucesso!"),r("/remessas")}catch(a){console.error("Erro ao finalizar remessa:",a),C.error("Ocorreu um erro ao finalizar a remessa.")}finally{j(!1)}}},ie=a=>{const t=a.target.value.replace(/\D/g,""),c=t.slice(12,17);x("numeroCheque",c),x("leitora",t)},x=(a,t)=>{O(c=>({...c,[a]:t}))},le=()=>{if(!l.leitora||!l.numeroCheque||!l.nome||!l.cpf||!l.valor||!l.quemRetirou||!l.dataRetirada||!l.banco){C.error("Por favor, preencha todos os campos obrigatórios.");return}const a={...l,regiao:l.regiao.trim()===""?"Não definido":l.regiao.trim()};$?(S(t=>t.map(c=>c.id===a.id?a:c)),E(!1)):S(t=>[...t,a]),O({id:G(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[]})},ce=a=>{const t=w.find(c=>c.id===a);t&&(O(t),E(!0))},de=a=>{S(t=>t.filter(c=>c.id!==a))},ue=async(a,t)=>{const c=M(B,`cheques/anexos/${t}/${a.name}`),q=await V(c,a);return await Y(q.ref)},me=async()=>{if(!(!s||!s.id)){if(j(!0),w.length===0){C.error("Adicione pelo menos um cheque antes de salvar."),j(!1);return}try{const a=Re(F,"cheques");for(const t of w){let c="";t.anexoFile&&(c=await ue(t.anexoFile,t.id));const q=await De(a,{leitora:t.leitora,numeroCheque:t.numeroCheque,nome:t.nome,cpf:t.cpf,valor:t.valor,motivoDevolucao:t.motivoDevolucao,numeroOperacao:t.numeroOperacao,anexoUrl:c,quemRetirou:t.quemRetirou,dataRetirada:t.dataRetirada,local:`Remessa ${s.protocolo}`,createdAt:L.now(),banco:t.banco,vencimento:t.vencimento,regiao:t.regiao,log:[{timestamp:L.now(),message:"Cheque adicionado à remessa",user:(d==null?void 0:d.displayName)||(d==null?void 0:d.email)||"Usuário desconhecido"}]}),b=q.id;await A(q,{id:b});const he=z(F,"remessas",s.id);await A(he,{cheques:k({id:b,numeroCheque:t.numeroCheque,banco:t.banco,vencimento:t.vencimento,nome:t.nome,valor:t.valor,regiao:t.regiao})}),n(P=>P&&{...P,cheques:P.cheques.concat({id:b,numeroCheque:t.numeroCheque,banco:t.banco,vencimento:t.vencimento,nome:t.nome,valor:t.valor,regiao:t.regiao,leitora:t.leitora,cpf:t.cpf,quemRetirou:t.quemRetirou,dataRetirada:t.dataRetirada,local:`Remessa ${s.protocolo}`})})}S([]),C.success("Cheques adicionados à remessa com sucesso!")}catch(a){console.error("Erro ao adicionar cheques:",a),C.error("Ocorreu um erro ao adicionar os cheques.")}finally{j(!1)}}};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(qe,{}),i?e.jsx("p",{children:"Carregando..."}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Detalhes da Remessa"}),e.jsx(N,{onClick:()=>r("/remessas"),children:"Voltar para Remessas"})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Protocolo:"})," ",s.protocolo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data da Remessa:"})," ",s.dataRemessa?ee(typeof s.dataRemessa=="string"?ae(s.dataRemessa):s.dataRemessa,"dd/MM/yyyy"):"Data não disponível"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Emitido por:"})," ",s.emitidoPor]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),s.recebidoPor&&e.jsxs("p",{children:[e.jsx("strong",{children:"Recebido por:"})," ",s.recebidoPor]}),s.documentoPdfUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento PDF:"})," ",e.jsx("a",{href:s.documentoPdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Download"})]}),s.documentoAssinadoUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento Assinado:"})," ",e.jsx("a",{href:s.documentoAssinadoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques na Remessa"}),s.status!=="Finalizada"&&e.jsxs(H,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(N,{variant:"outline",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Adicionar Cheque"]})}),e.jsxs(_,{className:"max-w-6xl",children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Adicionar Cheque"}),e.jsx(X,{children:"Preencha as informações abaixo para adicionar um novo cheque à remessa."})]}),e.jsx(Te,{className:"h-[400px] ",children:e.jsxs("div",{className:"space-y-1.5 pr-6 ",children:[e.jsxs("div",{className:"space-y-1 pr-2  ",children:[e.jsx(u,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(p,{type:"text",id:"leitora",value:l.leitora,onChange:a=>ie(a),placeholder:"Leitora",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(p,{type:"text",id:"numeroCheque",value:l.numeroCheque,onChange:a=>x("numeroCheque",a.target.value),placeholder:"Número do Cheque",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"nome",children:"Nome *"}),e.jsx(p,{type:"text",id:"nome",value:l.nome,onChange:a=>{a.target.value=a.target.value.toUpperCase(),x("nome",a.target.value)},placeholder:"Nome",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(p,{type:"text",id:"cpf",value:l.cpf,onChange:a=>x("cpf",a.target.value),placeholder:"CPF/CNPJ",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"valor",children:"Valor *"}),e.jsx(p,{type:"number",id:"valor",value:l.valor,onChange:a=>x("valor",Number(a.target.value)),placeholder:"Valor",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(Se,{value:l.motivoDevolucao,onValueChange:a=>x("motivoDevolucao",a),children:[e.jsx(ge,{children:e.jsxs(ve,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx("span",{className:"w-full",children:e.jsx(Pe,{className:"w-full",children:e.jsx(ze,{placeholder:"Motivo da devolução"})})})}),l.motivoDevolucao&&e.jsx(Ne,{})]})}),e.jsx(Ae,{children:Le.map(a=>e.jsxs(Ie,{value:`${a.classificacao} - ${a.motivo}`,children:[a.classificacao," - ",a.motivo]},a.classificacao))})]})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(p,{type:"text",id:"numeroOperacao",value:l.numeroOperacao,onChange:a=>x("numeroOperacao",a.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(p,{type:"file",id:"anexoFile",onChange:a=>x("anexoFile",a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(p,{type:"text",id:"quemRetirou",value:l.quemRetirou,onChange:a=>x("quemRetirou",a.target.value),placeholder:"Nome do responsável",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(p,{type:"date",id:"dataRetirada",value:l.dataRetirada,onChange:a=>x("dataRetirada",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"vencimento",children:"Vencimento do cheque *"}),e.jsx(p,{type:"date",id:"vencimento",value:l.vencimento,onChange:a=>x("vencimento",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"local",children:"Local *"}),e.jsx(p,{type:"text",id:"local",value:l.local,onChange:a=>x("local",a.target.value),placeholder:"Local do Cheque",required:!0,disabled:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"banco",children:"Banco *"}),e.jsx(p,{type:"text",id:"banco",value:l.banco,onChange:a=>x("banco",a.target.value),placeholder:"Banco",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"regiao",children:"Região *"}),e.jsx(p,{type:"text",id:"regiao",value:l.regiao,onChange:a=>x("regiao",a.target.value),placeholder:"Região",required:!0})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(N,{type:"button",onClick:le,children:$?"Atualizar Cheque":"Adicionar Cheque"}),e.jsx(N,{type:"button",onClick:me,disabled:f,children:f?"Salvando Cheques...":"Salvar Cheques"})]})]})]})]}),w.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques a serem adicionados"}),e.jsx("div",{className:"space-y-2",children:w.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Banco:"})," ",a.banco]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leitora:"})," ",a.leitora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Número do Cheque:"})," ",a.numeroCheque]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",a.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Região:"})," ",a.regiao||"Não definido"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",onClick:()=>ce(a.id),children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(N,{variant:"destructive",onClick:()=>de(a.id),children:e.jsx(Oe,{className:"w-4 h-4"})})]})]},a.id))})]}),e.jsx("div",{className:"rounded-md border mt-6",children:e.jsxs(be,{children:[e.jsx(we,{children:e.jsxs(Z,{children:[e.jsx(R,{children:"#"}),e.jsx(R,{children:"Número do Cheque"}),e.jsx(R,{children:"Banco"}),e.jsx(R,{children:"Vencimento"}),e.jsx(R,{children:"Nome"}),e.jsx(R,{children:"Região"})," ",e.jsx(R,{className:"text-right",children:"Valor"})]})}),e.jsx(Fe,{children:s.cheques.map((a,t)=>e.jsxs(Z,{children:[e.jsx(D,{children:t+1}),e.jsx(D,{children:a.numeroCheque}),e.jsx(D,{children:a.banco}),e.jsx(D,{children:a.vencimento?ee(ae(a.vencimento),"dd/MM/yyyy"):"Data não disponível"}),e.jsx(D,{children:a.nome}),e.jsx(D,{children:a.regiao||"Não definido"})," ",e.jsx(D,{className:"text-right",children:a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a.id||t))})]})})]}),s.status!=="Finalizada"&&e.jsx("div",{className:"mt-6",children:e.jsxs(H,{children:[e.jsx(W,{asChild:!0,children:e.jsx(N,{children:"Finalizar Remessa"})}),e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Finalizar Remessa"}),e.jsx(X,{children:"Preencha as informações abaixo para finalizar a remessa."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"recebidoPor",children:"Recebido por *"}),e.jsx(p,{type:"text",id:"recebidoPor",value:y,onChange:a=>oe(a.target.value),placeholder:"Nome de quem recebeu",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"documentoAssinado",children:"Documento Assinado *"}),e.jsx(p,{type:"file",id:"documentoAssinado",onChange:a=>h(a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{onClick:ne,disabled:f,children:f?"Finalizando...":"Finalizar Remessa"})})]})]})]})})]}):e.jsx("p",{children:"Remessa não encontrada."})]})};export{da as default};
