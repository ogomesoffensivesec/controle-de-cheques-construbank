import{c as je,aj as ge,u as ve,s as Ce,r as g,a6 as V,j as e,Q as Ne,B as v,L as u,I as h,ae as ye,af as Re,ag as De,ah as qe,ad as be,ar as w,l as q,as as Fe,n as j,D as Y,E as H,F as Z,G as W,au as I,av as O,T as z,k as we,ai as Te,ax as Se}from"./index-CLtyk14W.js";import{T as Pe,a as Ie,b as _,c as N,d as ze,e as y}from"./table-C9yEHQlt.js";import{D as J,f as Q,a as G,b as K,c as X,d as ee}from"./dialog-BINoGk4B.js";import{S as Ae}from"./scroll-area-DEKxqJx0.js";import{S as Le,a as ke,b as Oe,c as Ee,d as Ue,e as Me}from"./cheques--DLE8VzO.js";import{t as ae,o as te,p as oe,c as $e,k as se}from"./format-CphUbbWy.js";import{P as Be}from"./pen-B4KfQ9Ef.js";import"./index-BFRFAaAD.js";import"./check-D-40C26n.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=je("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function re(o,s){const i=()=>$e(s==null?void 0:s.in,NaN),n=We(o);let x;if(n.date){const d=_e(n.date,2);x=Je(d.restDateString,d.year)}if(!x||isNaN(+x))return i();const C=+x;let p=0,f;if(n.time&&(p=Qe(n.time),isNaN(p)))return i();if(n.timezone){if(f=Ge(n.timezone),isNaN(f))return i()}else{const d=new Date(C+p),b=ae(0,s==null?void 0:s.in);return b.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),b.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),b}return ae(C+p+f,s==null?void 0:s.in)}const A={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ye=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,He=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ze=/^([+-])(\d{2})(?::?(\d{2}))?$/;function We(o){const s={},i=o.split(A.dateTimeDelimiter);let t;if(i.length>2)return s;if(/:/.test(i[0])?t=i[0]:(s.date=i[0],t=i[1],A.timeZoneDelimiter.test(s.date)&&(s.date=o.split(A.timeZoneDelimiter)[0],t=o.substr(s.date.length,o.length))),t){const n=A.timezone.exec(t);n?(s.time=t.replace(n[1],""),s.timezone=n[1]):s.time=t}return s}function _e(o,s){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),t=o.match(i);if(!t)return{year:NaN,restDateString:""};const n=t[1]?parseInt(t[1]):null,x=t[2]?parseInt(t[2]):null;return{year:x===null?n:x*100,restDateString:o.slice((t[1]||t[2]).length)}}function Je(o,s){if(s===null)return new Date(NaN);const i=o.match(Ye);if(!i)return new Date(NaN);const t=!!i[4],n=T(i[1]),x=T(i[2])-1,C=T(i[3]),p=T(i[4]),f=T(i[5])-1;if(t)return sa(s,p,f)?Ke(s,p,f):new Date(NaN);{const d=new Date(0);return!ea(s,x,C)||!aa(s,n)?new Date(NaN):(d.setUTCFullYear(s,x,Math.max(n,C)),d)}}function T(o){return o?parseInt(o):1}function Qe(o){const s=o.match(He);if(!s)return NaN;const i=E(s[1]),t=E(s[2]),n=E(s[3]);return ra(i,t,n)?i*te+t*oe+n*1e3:NaN}function E(o){return o&&parseFloat(o.replace(",","."))||0}function Ge(o){if(o==="Z")return 0;const s=o.match(Ze);if(!s)return 0;const i=s[1]==="+"?-1:1,t=parseInt(s[2]),n=s[3]&&parseInt(s[3])||0;return ta(t,n)?i*(t*te+n*oe):NaN}function Ke(o,s,i){const t=new Date(0);t.setUTCFullYear(o,0,4);const n=t.getUTCDay()||7,x=(s-1)*7+i+1-n;return t.setUTCDate(t.getUTCDate()+x),t}const Xe=[31,null,31,30,31,30,31,31,30,31,30,31];function ie(o){return o%400===0||o%4===0&&o%100!==0}function ea(o,s,i){return s>=0&&s<=11&&i>=1&&i<=(Xe[s]||(ie(o)?29:28))}function aa(o,s){return s>=1&&s<=(ie(o)?366:365)}function sa(o,s,i){return s>=1&&s<=53&&i>=0&&i<=6}function ra(o,s,i){return o===24?s===0&&i===0:i>=0&&i<60&&s>=0&&s<60&&o>=0&&o<25}function ta(o,s){return s>=0&&s<=59}const xa=()=>{const{id:o}=ge(),{currentUser:s}=ve(),i=Ce(),[t,n]=g.useState(null),[x,C]=g.useState(!0),[p,f]=g.useState(!1),[d,b]=g.useState(null),[L,ne]=g.useState(""),[U,M]=g.useState(!1),[F,S]=g.useState([]),[l,k]=g.useState({id:V(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""}),[$,B]=g.useState(!1);g.useEffect(()=>{s.isClient&&i("/"),(async()=>{if(o){C(!0);try{const r=w(q,"remessas",o),c=await Fe(r);c.exists()?n({id:c.id,...c.data()}):j.error("Remessa não encontrada.")}catch(r){console.error("Erro ao buscar remessa:",r),j.error("Ocorreu um erro ao buscar a remessa.")}finally{C(!1)}}})()},[o]);const le=async()=>{if(!(!t||!t.id)){if(!d||!L){j.error("Por favor, preencha todos os campos.");return}f(!0);try{const a=Y(H,`remessas/${t.id}/${d.name}`);await Z(a,d);const r=await W(a),c=w(q,"remessas",t.id);await I(c,{documentoAssinadoUrl:r,recebidoPor:L,status:"Finalizada",log:O({timestamp:z.now(),message:"Remessa finalizada",user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"})});for(const R of t.cheques){const D=w(q,"cheques",R.id);await I(D,{local:"Destino Final",log:O({timestamp:z.now(),message:`Remessa ${t.protocolo} finalizada`,user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"})})}j.success("Remessa finalizada com sucesso!"),i("/remessas")}catch(a){console.error("Erro ao finalizar remessa:",a),j.error("Ocorreu um erro ao finalizar a remessa.")}finally{f(!1)}}},ce=a=>{const r=a.target.value.replace(/\D/g,""),c=r.slice(12,17);m("numeroCheque",c),m("leitora",r)},m=(a,r)=>{k(c=>({...c,[a]:r}))},de=()=>{if(!l.leitora||!l.numeroCheque||!l.nome||!l.cpf||!l.valor||!l.quemRetirou||!l.dataRetirada||!l.banco){j.error("Por favor, preencha todos os campos obrigatórios.");return}const a={...l,regiao:l.regiao.trim()===""?"Não definido":l.regiao.trim()};$?(S(r=>r.map(c=>c.id===a.id?a:c)),B(!1)):S(r=>[...r,a]),k({id:V(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""})},ue=a=>{const r=F.find(c=>c.id===a);r&&(k(r),B(!0))},me=a=>{S(r=>r.filter(c=>c.id!==a))},he=async(a,r)=>{const c=Y(H,`cheques/anexos/${r}/${a.name}`),R=await Z(c,a);return await W(R.ref)},xe=async()=>{if(!(!t||!t.id)){if(f(!0),F.length===0){j.error("Adicione pelo menos um cheque antes de salvar."),f(!1);return}try{const a=we(q,"cheques");for(const r of F){let c="";r.anexoFile&&(c=await he(r.anexoFile,r.id));const R=await Te(a,{leitora:r.leitora,numeroCheque:r.numeroCheque,nome:r.nome,cpf:r.cpf,valor:r.valor,motivoDevolucao:r.motivoDevolucao,numeroOperacao:r.numeroOperacao,anexoUrl:c,quemRetirou:r.quemRetirou,dataRetirada:r.dataRetirada,local:`Remessa ${t.protocolo}`,createdAt:z.now(),banco:r.banco,vencimento:r.vencimento,regiao:r.regiao,log:[{timestamp:z.now(),message:"Cheque adicionado à remessa",user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"}]}),D=R.id;await I(R,{id:D});const fe=w(q,"remessas",t.id);await I(fe,{cheques:O({id:D,numeroCheque:r.numeroCheque,banco:r.banco,vencimento:r.vencimento,nome:r.nome,valor:r.valor,regiao:r.regiao})}),n(P=>P&&{...P,cheques:P.cheques.concat({id:D,numeroCheque:r.numeroCheque,banco:r.banco,vencimento:r.vencimento,nome:r.nome,valor:r.valor,regiao:r.regiao,leitora:r.leitora,cpf:r.cpf,quemRetirou:r.quemRetirou,dataRetirada:r.dataRetirada,clientId:r.clientId,local:`Remessa ${t.protocolo}`})})}S([]),j.success("Cheques adicionados à remessa com sucesso!")}catch(a){console.error("Erro ao adicionar cheques:",a),j.error("Ocorreu um erro ao adicionar os cheques.")}finally{f(!1)}}},pe=async a=>{try{M(!0);const r=w(q,"remessas",a);await Se(r),j.success("Remessa excluída com sucesso!"),i("/remessas")}catch(r){j.error("Erro ao deletar remessa"),console.error(r)}finally{M(!1)}};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(Ne,{}),x?e.jsx("p",{children:"Carregando..."}):t?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Detalhes da Remessa"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>i("/remessas"),children:"Voltar para Remessas"}),e.jsx(v,{onClick:()=>pe(t.id||""),variant:"destructive",disabled:U,children:U?"Excluindo remessa...":"Excuir remessa"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Protocolo:"})," ",t.protocolo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data da Remessa:"})," ",t.dataRemessa?se(typeof t.dataRemessa=="string"?re(t.dataRemessa):t.dataRemessa,"dd/MM/yyyy"):"Data não disponível"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Emitido por:"})," ",t.emitidoPor]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),t.recebidoPor&&e.jsxs("p",{children:[e.jsx("strong",{children:"Recebido por:"})," ",t.recebidoPor]}),t.documentoPdfUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento PDF:"})," ",e.jsx("a",{href:t.documentoPdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Download"})]}),t.documentoAssinadoUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento Assinado:"})," ",e.jsx("a",{href:t.documentoAssinadoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques na Remessa"}),t.status!=="Finalizada"&&e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(v,{variant:"outline",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Adicionar Cheque"]})}),e.jsxs(G,{className:"max-w-6xl",children:[e.jsxs(K,{children:[e.jsx(X,{children:"Adicionar Cheque"}),e.jsx(ee,{children:"Preencha as informações abaixo para adicionar um novo cheque à remessa."})]}),e.jsx(Ae,{className:"h-[400px] ",children:e.jsxs("div",{className:"space-y-1.5 pr-6 ",children:[e.jsxs("div",{className:"space-y-1 pr-2  ",children:[e.jsx(u,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(h,{type:"text",id:"leitora",value:l.leitora,onChange:a=>ce(a),placeholder:"Leitora",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(h,{type:"text",id:"numeroCheque",value:l.numeroCheque,onChange:a=>m("numeroCheque",a.target.value),placeholder:"Número do Cheque",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"nome",children:"Nome *"}),e.jsx(h,{type:"text",id:"nome",value:l.nome,onChange:a=>{a.target.value=a.target.value.toUpperCase(),m("nome",a.target.value)},placeholder:"Nome",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(h,{type:"text",id:"cpf",value:l.cpf,onChange:a=>m("cpf",a.target.value),placeholder:"CPF/CNPJ",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"valor",children:"Valor *"}),e.jsx(h,{type:"number",id:"valor",value:l.valor,onChange:a=>m("valor",Number(a.target.value)),placeholder:"Valor",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(Le,{value:l.motivoDevolucao,onValueChange:a=>m("motivoDevolucao",a),children:[e.jsx(ye,{children:e.jsxs(Re,{children:[e.jsx(De,{asChild:!0,children:e.jsx("span",{className:"w-full",children:e.jsx(ke,{className:"w-full",children:e.jsx(Oe,{placeholder:"Motivo da devolução"})})})}),l.motivoDevolucao&&e.jsx(qe,{})]})}),e.jsx(Ee,{children:Ue.map(a=>e.jsxs(Me,{value:`${a.classificacao} - ${a.motivo}`,children:[a.classificacao," - ",a.motivo]},a.classificacao))})]})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(h,{type:"text",id:"numeroOperacao",value:l.numeroOperacao,onChange:a=>m("numeroOperacao",a.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(h,{type:"file",id:"anexoFile",onChange:a=>m("anexoFile",a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(h,{type:"text",id:"quemRetirou",value:l.quemRetirou,onChange:a=>m("quemRetirou",a.target.value),placeholder:"Nome do responsável",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(h,{type:"date",id:"dataRetirada",value:l.dataRetirada,onChange:a=>m("dataRetirada",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"vencimento",children:"Vencimento do cheque *"}),e.jsx(h,{type:"date",id:"vencimento",value:l.vencimento,onChange:a=>m("vencimento",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"local",children:"Local *"}),e.jsx(h,{type:"text",id:"local",value:l.local,onChange:a=>m("local",a.target.value),placeholder:"Local do Cheque",required:!0,disabled:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"banco",children:"Banco *"}),e.jsx(h,{type:"text",id:"banco",value:l.banco,onChange:a=>m("banco",a.target.value),placeholder:"Banco",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"regiao",children:"Região *"}),e.jsx(h,{type:"text",id:"regiao",value:l.regiao,onChange:a=>m("regiao",a.target.value),placeholder:"Região",required:!0})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(v,{type:"button",onClick:de,children:$?"Atualizar Cheque":"Adicionar Cheque"}),e.jsx(v,{type:"button",onClick:xe,disabled:p,children:p?"Salvando Cheques...":"Salvar Cheques"})]})]})]})]}),F.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques a serem adicionados"}),e.jsx("div",{className:"space-y-2",children:F.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Banco:"})," ",a.banco]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leitora:"})," ",a.leitora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Número do Cheque:"})," ",a.numeroCheque]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",a.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Região:"})," ",a.regiao||"Não definido"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{variant:"outline",onClick:()=>ue(a.id),children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsx(v,{variant:"destructive",onClick:()=>me(a.id),children:e.jsx(be,{className:"w-4 h-4"})})]})]},a.id))})]}),e.jsx("div",{className:"rounded-md border mt-6",children:e.jsxs(Pe,{children:[e.jsx(Ie,{children:e.jsxs(_,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Número do Cheque"}),e.jsx(N,{children:"Banco"}),e.jsx(N,{children:"Vencimento"}),e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Região"})," ",e.jsx(N,{className:"text-right",children:"Valor"})]})}),e.jsx(ze,{children:t.cheques.map((a,r)=>e.jsxs(_,{children:[e.jsx(y,{children:r+1}),e.jsx(y,{children:a.numeroCheque}),e.jsx(y,{children:a.banco}),e.jsx(y,{children:a.vencimento?se(re(a.vencimento),"dd/MM/yyyy"):"Data não disponível"}),e.jsx(y,{children:a.nome}),e.jsx(y,{children:a.regiao||"Não definido"})," ",e.jsx(y,{className:"text-right",children:a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a.id||r))})]})})]}),t.status!=="Finalizada"&&e.jsx("div",{className:"mt-6",children:e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(v,{children:"Finalizar Remessa"})}),e.jsxs(G,{children:[e.jsxs(K,{children:[e.jsx(X,{children:"Finalizar Remessa"}),e.jsx(ee,{children:"Preencha as informações abaixo para finalizar a remessa."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"recebidoPor",children:"Recebido por *"}),e.jsx(h,{type:"text",id:"recebidoPor",value:L,onChange:a=>ne(a.target.value),placeholder:"Nome de quem recebeu",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"documentoAssinado",children:"Documento Assinado *"}),e.jsx(h,{type:"file",id:"documentoAssinado",onChange:a=>b(a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{onClick:le,disabled:p,children:p?"Finalizando...":"Finalizar Remessa"})})]})]})]})})]}):e.jsx("p",{children:"Remessa não encontrada."})]})};export{xa as default};
