import{r as h,u as W,a6 as B,s as X,j as e,Q as Y,a7 as Z,a8 as ee,a9 as f,aa as O,ab as A,ac as ae,B as x,ad as se,L as i,I as n,ae as oe,af as re,ag as te,ah as ie,n as d,k as I,l as T,m as le,ai as ne,T as V,D as ce,E as de,F as he,G as ue}from"./index-CLtyk14W.js";import{S as q,a as y,b as N,c as b,d as me,e as p}from"./cheques--DLE8VzO.js";import{P as xe}from"./pen-B4KfQ9Ef.js";import"./index-BFRFAaAD.js";import"./check-D-40C26n.js";const pe=({currentPage:l,totalPages:u,onPageChange:c})=>e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[e.jsx(x,{variant:"outline",disabled:l===1,onClick:()=>c(l-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",l," de ",u]}),e.jsx(x,{variant:"outline",disabled:l===u,onClick:()=>c(l+1),children:"Próxima"})]}),qe=()=>{const[l,u]=h.useState([]),{currentUser:c}=W(),[k,U]=h.useState([]),[s,j]=h.useState({id:B(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""}),[R,v]=h.useState(!1),[F,S]=h.useState(!1),w=X(),[D,L]=h.useState(1),g=3,t=(a,r)=>{j(o=>({...o,[a]:r}))},z=()=>{if(!s.leitora||!s.numeroCheque||!s.nome||!s.cpf||!s.valor||!s.quemRetirou||!s.dataRetirada||!s.banco||!s.local||!s.regiao){d.error("Por favor, preencha todos os campos obrigatórios.");return}F?(u(a=>a.map(r=>r.id===s.id?s:r)),S(!1),d.success("Cheque atualizado na lista!")):(u(a=>[...a,s]),d.success("Cheque adicionado à lista!")),j({id:B(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""}),L(1)},$=a=>{const r=l.find(o=>o.id===a);r&&(j(r),S(!0))},M=a=>{window.confirm("Tem certeza de que deseja remover este cheque da lista?")&&(u(r=>r.filter(o=>o.id!==a)),d.success("Cheque removido da lista!"))},J=async(a,r)=>{const o=ce(de,`cheques/anexos/${r}/${a.name}`),m=await he(o,a);return await ue(m.ref)};h.useEffect(()=>{if(c.isClient){w("/");return}(async()=>{try{const r=I(T,"clientes"),m=await(await le(r)).docs.map(C=>({id:C.id,...C.data()}));U(m)}catch(r){console.error("Erro ao buscar cheques:",r),d.error("Ocorreu um erro ao buscar os cheques.")}})()},[]);const Q=async a=>{if(a.preventDefault(),v(!0),l.length===0){d.error("Adicione pelo menos um cheque antes de salvar."),v(!1);return}try{const r=I(T,"cheques");for(const o of l){let m="";o.anexoFile&&(m=await J(o.anexoFile,o.id)),await ne(r,{leitora:o.leitora,numeroCheque:o.numeroCheque,nome:o.nome,cpf:o.cpf,valor:o.valor,motivoDevolucao:o.motivoDevolucao,numeroOperacao:o.numeroOperacao,anexoUrl:m,quemRetirou:o.quemRetirou,dataRetirada:o.dataRetirada,local:o.local,regiao:o.regiao,createdAt:V.now(),banco:o.banco,clientId:o.clientId,vencimento:o.vencimento,log:[{timestamp:V.now(),message:"Cheque adicionado",user:(c==null?void 0:c.displayName)||(c==null?void 0:c.email)||"Usuário desconhecido"}]})}d.success("Cheques cadastrados com sucesso!"),w("/cheques")}catch(r){console.error("Erro ao cadastrar cheques:",r),d.error("Ocorreu um erro ao cadastrar os cheques.")}finally{v(!1)}},G=a=>{const r=a.target.value.replace(/\D/g,""),o=r.slice(12,17);t("numeroCheque",o),t("leitora",r)},E=D*g,K=E-g,_=l.slice(K,E),P=Math.ceil(l.length/g),H=a=>{a<1||a>P||L(a)};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(Y,{}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(f,{children:e.jsx(O,{href:"/",children:"Dashboard"})}),e.jsx(A,{}),e.jsx(f,{children:e.jsx(O,{href:"/cheques",children:"Lista de Cheques"})}),e.jsx(A,{}),e.jsx(f,{children:e.jsx(ae,{children:"Cadastro de Cheques"})})]})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-2xl font-bold",children:"Cadastrar Cheques"})}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques Adicionados"}),e.jsx("div",{className:"space-y-2",children:_.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",a.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Número do Cheque:"})," ",a.numeroCheque]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Região:"})," ",a.regiao," "]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{variant:"outline",onClick:()=>$(a.id),title:"Editar Cheque",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(x,{variant:"destructive",onClick:()=>M(a.id),title:"Remover Cheque",children:e.jsx(se,{className:"w-4 h-4"})})]})]},a.id))}),e.jsx(pe,{currentPage:D,totalPages:P,onPageChange:H})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",onKeyDown:a=>{a.key==="Enter"&&a.preventDefault()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(n,{type:"text",id:"leitora",value:s.leitora,onChange:a=>G(a),placeholder:"Leitora"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(n,{type:"text",id:"numeroCheque",value:s.numeroCheque,onChange:a=>t("numeroCheque",a.target.value),placeholder:"Número do Cheque"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"nome",children:"Nome *"}),e.jsx(n,{type:"text",id:"nome",value:s.nome,onChange:a=>{a.target.value=a.target.value.toUpperCase(),t("nome",a.target.value)},placeholder:"Nome"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(n,{type:"text",id:"cpf",value:s.cpf,onChange:a=>t("cpf",a.target.value),placeholder:"CPF/CNPJ"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"valor",children:"Valor *"}),e.jsx(n,{type:"number",id:"valor",value:s.valor,onChange:a=>t("valor",Number(a.target.value)),placeholder:"Valor"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(q,{value:s.motivoDevolucao,onValueChange:a=>t("motivoDevolucao",a),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Motivo da devolução"})}),e.jsx(b,{children:me.map(a=>e.jsx(p,{value:`${a.classificacao} - ${a.motivo}`,children:e.jsx(oe,{children:e.jsxs(re,{children:[e.jsx(te,{asChild:!0,children:e.jsxs("span",{children:[a.classificacao," - ",a.motivo]})}),a.descricao&&e.jsx(ie,{children:a.descricao})]})})},a.classificacao))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(n,{type:"text",id:"numeroOperacao",value:s.numeroOperacao,onChange:a=>t("numeroOperacao",a.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"banco",children:"Banco *"}),e.jsx(n,{type:"text",id:"banco",value:s.banco,onChange:a=>t("banco",a.target.value),placeholder:"Banco"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"vencimento",children:"Vencimento do Cheque *"}),e.jsx(n,{type:"date",id:"vencimento",value:s.vencimento,onChange:a=>t("vencimento",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"regiao",children:"Região *"}),e.jsx(n,{type:"text",id:"regiao",value:s.regiao,onChange:a=>t("regiao",a.target.value),placeholder:"Região"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"local",children:"Local *"}),e.jsxs(q,{disabled:!0,value:s.local,onValueChange:a=>t("local",a),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Selecione o local"})}),e.jsxs(b,{children:[e.jsx(p,{value:"Escritório",children:"Escritório"}),e.jsx(p,{value:"Transporte",children:"Transporte"}),e.jsx(p,{value:"Destino Final",children:"Destino Final"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(n,{type:"file",id:"anexoFile",onChange:a=>t("anexoFile",a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"}),s.anexoUrl&&e.jsxs("p",{className:"mt-2",children:["Anexo atual:"," ",e.jsx("a",{href:s.anexoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(n,{type:"text",id:"quemRetirou",value:s.quemRetirou,onChange:a=>t("quemRetirou",a.target.value),placeholder:"Nome do responsável"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(n,{type:"date",id:"dataRetirada",value:s.dataRetirada,onChange:a=>t("dataRetirada",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"clientId",children:"Cliente *"}),e.jsxs(q,{onValueChange:a=>t("clientId",a),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Selecione o cliente"})}),e.jsx(b,{children:k.map(a=>e.jsx(p,{value:a.id,children:a.nome},a.id))})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(x,{type:"button",onClick:z,children:F?"Atualizar Cheque":"Adicionar Cheque"}),e.jsx(x,{type:"submit",disabled:R,children:R?"Cadastrando Cheques...":"Cadastrar Cheques"})]})]})]})};export{qe as default};
