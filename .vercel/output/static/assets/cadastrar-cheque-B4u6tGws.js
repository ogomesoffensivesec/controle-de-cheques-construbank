import{r as m,X as Q,i as _,j as e,B as h,L as i,I as n,Y as K,Z as X,_ as Y,$ as Z,d as G,e as H,a0 as W,T as w,q as ee,t as ae,v as se,w as re}from"./index-BbvhRV2G.js";import{Q as oe,B as d}from"./ReactToastify-BnRepkc8.js";import{B as te,a as ie,b as C,c as D,d as S,e as le}from"./breadcrumb-BMy_I3Hd.js";import{T as ne,S as L,a as B,b as P,c as A,d as ce,e as p}from"./cheques-CFuCuQAy.js";import{v as E,P as de}from"./v4-C7CeI08w.js";import"./chevron-right-C4WEIDWe.js";import"./check-kthi0gF7.js";const ue=({currentPage:l,totalPages:u,onPageChange:c})=>e.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[e.jsx(h,{variant:"outline",disabled:l===1,onClick:()=>c(l-1),children:"Anterior"}),e.jsxs("span",{children:["Página ",l," de ",u]}),e.jsx(h,{variant:"outline",disabled:l===u,onClick:()=>c(l+1),children:"Próxima"})]}),fe=()=>{const[l,u]=m.useState([]),{currentUser:c}=Q(),[s,v]=m.useState({id:E(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[]}),[f,j]=m.useState(!1),[q,y]=m.useState(!1),O=_(),[N,b]=m.useState(1),g=3,t=(a,o)=>{v(r=>({...r,[a]:o}))},T=()=>{if(!s.leitora||!s.numeroCheque||!s.nome||!s.cpf||!s.valor||!s.quemRetirou||!s.dataRetirada||!s.banco||!s.local||!s.regiao){d.error("Por favor, preencha todos os campos obrigatórios.");return}q?(u(a=>a.map(o=>o.id===s.id?s:o)),y(!1),d.success("Cheque atualizado na lista!")):(u(a=>[...a,s]),d.success("Cheque adicionado à lista!")),v({id:E(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[]}),b(1)},V=a=>{const o=l.find(r=>r.id===a);o&&(v(o),y(!0))},k=a=>{window.confirm("Tem certeza de que deseja remover este cheque da lista?")&&(u(o=>o.filter(r=>r.id!==a)),d.success("Cheque removido da lista!"))},I=async(a,o)=>{const r=ee(ae,`cheques/anexos/${o}/${a.name}`),x=await se(r,a);return await re(x.ref)},U=async a=>{if(a.preventDefault(),j(!0),l.length===0){d.error("Adicione pelo menos um cheque antes de salvar."),j(!1);return}try{const o=G(H,"cheques");for(const r of l){let x="";r.anexoFile&&(x=await I(r.anexoFile,r.id)),await W(o,{leitora:r.leitora,numeroCheque:r.numeroCheque,nome:r.nome,cpf:r.cpf,valor:r.valor,motivoDevolucao:r.motivoDevolucao,numeroOperacao:r.numeroOperacao,anexoUrl:x,quemRetirou:r.quemRetirou,dataRetirada:r.dataRetirada,local:r.local,regiao:r.regiao,createdAt:w.now(),banco:r.banco,vencimento:r.vencimento,log:[{timestamp:w.now(),message:"Cheque adicionado",user:(c==null?void 0:c.displayName)||(c==null?void 0:c.email)||"Usuário desconhecido"}]})}d.success("Cheques cadastrados com sucesso!"),O("/cheques")}catch(o){console.error("Erro ao cadastrar cheques:",o),d.error("Ocorreu um erro ao cadastrar os cheques.")}finally{j(!1)}},$=a=>{const o=a.target.value.replace(/\D/g,""),r=o.slice(12,17);t("numeroCheque",r),t("leitora",o)},R=N*g,z=R-g,M=l.slice(z,R),F=Math.ceil(l.length/g),J=a=>{a<1||a>F||b(a)};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(oe,{}),e.jsx(te,{children:e.jsxs(ie,{children:[e.jsx(C,{children:e.jsx(D,{href:"/",children:"Dashboard"})}),e.jsx(S,{}),e.jsx(C,{children:e.jsx(D,{href:"/cheques",children:"Lista de Cheques"})}),e.jsx(S,{}),e.jsx(C,{children:e.jsx(le,{children:"Cadastro de Cheques"})})]})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-2xl font-bold",children:"Cadastrar Cheques"})}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques Adicionados"}),e.jsx("div",{className:"space-y-2",children:M.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",a.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Número do Cheque:"})," ",a.numeroCheque]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Região:"})," ",a.regiao," "]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"outline",onClick:()=>V(a.id),title:"Editar Cheque",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(h,{variant:"destructive",onClick:()=>k(a.id),title:"Remover Cheque",children:e.jsx(ne,{className:"w-4 h-4"})})]})]},a.id))}),e.jsx(ue,{currentPage:N,totalPages:F,onPageChange:J})]}),e.jsxs("form",{onSubmit:U,className:"space-y-6",onKeyDown:a=>{a.key==="Enter"&&a.preventDefault()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(n,{type:"text",id:"leitora",value:s.leitora,onChange:a=>$(a),placeholder:"Leitora",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(n,{type:"text",id:"numeroCheque",value:s.numeroCheque,onChange:a=>t("numeroCheque",a.target.value),placeholder:"Número do Cheque",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"nome",children:"Nome *"}),e.jsx(n,{type:"text",id:"nome",value:s.nome,onChange:a=>{a.target.value=a.target.value.toUpperCase(),t("nome",a.target.value)},placeholder:"Nome",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(n,{type:"text",id:"cpf",value:s.cpf,onChange:a=>t("cpf",a.target.value),placeholder:"CPF/CNPJ",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"valor",children:"Valor *"}),e.jsx(n,{type:"number",id:"valor",value:s.valor,onChange:a=>t("valor",Number(a.target.value)),placeholder:"Valor",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(L,{value:s.motivoDevolucao,onValueChange:a=>t("motivoDevolucao",a),children:[e.jsx(B,{children:e.jsx(P,{placeholder:"Motivo da devolução"})}),e.jsx(A,{children:ce.map(a=>e.jsx(p,{value:`${a.classificacao} - ${a.motivo}`,children:e.jsx(K,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs("span",{children:[a.classificacao," - ",a.motivo]})}),a.descricao&&e.jsx(Z,{children:a.descricao})]})})},a.classificacao))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(n,{type:"text",id:"numeroOperacao",value:s.numeroOperacao,onChange:a=>t("numeroOperacao",a.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"banco",children:"Banco *"}),e.jsx(n,{type:"text",id:"banco",value:s.banco,onChange:a=>t("banco",a.target.value),placeholder:"Banco",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"vencimento",children:"Vencimento do Cheque *"}),e.jsx(n,{type:"date",id:"vencimento",value:s.vencimento,onChange:a=>t("vencimento",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"regiao",children:"Região *"}),e.jsx(n,{type:"text",id:"regiao",value:s.regiao,onChange:a=>t("regiao",a.target.value),placeholder:"Região",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"local",children:"Local *"}),e.jsxs(L,{disabled:!0,value:s.local,onValueChange:a=>t("local",a),required:!0,children:[e.jsx(B,{children:e.jsx(P,{placeholder:"Selecione o local"})}),e.jsxs(A,{children:[e.jsx(p,{value:"Escritório",children:"Escritório"}),e.jsx(p,{value:"Transporte",children:"Transporte"}),e.jsx(p,{value:"Destino Final",children:"Destino Final"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(n,{type:"file",id:"anexoFile",onChange:a=>t("anexoFile",a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"}),s.anexoUrl&&e.jsxs("p",{className:"mt-2",children:["Anexo atual:"," ",e.jsx("a",{href:s.anexoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(n,{type:"text",id:"quemRetirou",value:s.quemRetirou,onChange:a=>t("quemRetirou",a.target.value),placeholder:"Nome do responsável",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(n,{type:"date",id:"dataRetirada",value:s.dataRetirada,onChange:a=>t("dataRetirada",a.target.value),required:!0})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(h,{type:"button",onClick:T,children:q?"Atualizar Cheque":"Adicionar Cheque"}),e.jsx(h,{type:"submit",disabled:f,children:f?"Cadastrando Cheques...":"Cadastrar Cheques"})]})]})]})};export{fe as default};
