import{c as M,a1 as H,i as J,r as x,X as Q,j as e,a2 as _,a3 as X,B as g,a4 as Y,a5 as Z,a6 as G,a7 as K,L as i,I as n,Y as W,Z as ee,_ as ae,$ as oe,a8 as j,e as h,a9 as se,q as v,t as q,aa as z,ab as re,ac as te,T as C,ad as O,ae as le,v as ie,w as ne}from"./index-BbvhRV2G.js";import{Q as ce,B as p}from"./ReactToastify-BnRepkc8.js";import{C as de,c as me}from"./card-B_X8Bhg9.js";import{B as ue,a as he,b as N,c as I,d as B,e as xe}from"./breadcrumb-BMy_I3Hd.js";import{S as E}from"./scroll-area-Bod4G2A0.js";import{S as pe,a as je,b as fe,c as ge,d as ve,e as qe,T as Ce}from"./cheques-CFuCuQAy.js";import{k as Ne}from"./format-CphUbbWy.js";import"./chevron-right-C4WEIDWe.js";import"./check-kthi0gF7.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=M("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ie=()=>{const{id:d}=H(),y=J(),[a,R]=x.useState(null),[T,D]=x.useState(!0),[b,w]=x.useState(!1),[F,S]=x.useState(!1),[U,L]=x.useState(!1),{currentUser:r}=Q();x.useEffect(()=>{(async()=>{if(d){D(!0);try{const s=j(h,"cheques",d),t=await se(s);if(t.exists()){const m=t.data();R({...m,id:d,regiao:m.regiao||"Não definido"})}else p.error("Cheque não encontrado.")}catch(s){console.error("Erro ao buscar cheque:",s),p.error("Ocorreu um erro ao buscar o cheque.")}finally{D(!1)}}})()},[d]);const l=(o,s)=>{a&&R(t=>t&&{...t,[o]:s})},A=async o=>{if(!a)return"";const s=v(q,`cheques/anexos/${d}/${o.name}`),t=await ie(s,o);return await ne(t.ref)},P=async()=>{if(!a){console.log("Nenhum cheque fornecido.");return}w(!0),console.log("Iniciando atualização do cheque...",{cheque:a});try{let o=a.anexoUrl;if(console.log("URL inicial do anexo:",o),a.anexoFile){if(console.log("Novo arquivo de anexo detectado:",a.anexoFile),a.anexoUrl){console.log("Deletando anexo anterior:",a.anexoUrl);const t=v(q,a.anexoUrl);await z(t),console.log("Anexo anterior deletado com sucesso.")}o=await A(a.anexoFile),console.log("Novo anexo carregado com sucesso:",o)}const s=j(h,"cheques",d);if(console.log("Atualizando cheque no Firestore:",{...a,anexoUrl:o}),await re(s,{leitora:a.leitora,numeroCheque:a.numeroCheque,nome:a.nome,cpf:a.cpf,valor:a.valor,motivoDevolucao:a.motivoDevolucao,numeroOperacao:a.numeroOperacao,anexoUrl:o,quemRetirou:a.quemRetirou,dataRetirada:a.dataRetirada,regiao:a.regiao,log:te({timestamp:C.now(),message:"Cheque atualizado",user:(r==null?void 0:r.displayName)||(r==null?void 0:r.email)||"Usuário desconhecido"})}),console.log("Cheque atualizado com sucesso no Firestore."),a.remessaId){console.log("Cheque associado a uma remessa. ID da remessa:",a.remessaId);const t=j(h,"remessas",a.remessaId);await O(h,async m=>{const u=await m.get(t);if(!u.exists())throw new Error("Remessa não encontrada.");const c=u.data();console.log("Dados da remessa antes da atualização:",c);const f=c.cheques.findIndex($=>$.id===d);if(f===-1)throw new Error("Cheque não encontrado na remessa.");c.cheques[f]={...c.cheques[f],leitora:a.leitora,numeroCheque:a.numeroCheque,nome:a.nome,cpf:a.cpf,valor:a.valor,motivoDevolucao:a.motivoDevolucao,numeroOperacao:a.numeroOperacao,anexoUrl:a.anexoUrl,quemRetirou:a.quemRetirou,dataRetirada:a.dataRetirada,regiao:a.regiao},console.log("Cheque atualizado dentro da remessa:",c.cheques[f]),c.log||(c.log=[]),c.log.push({timestamp:C.now(),message:`Cheque ${a.numeroCheque} atualizado`,user:(r==null?void 0:r.displayName)||(r==null?void 0:r.email)||"Usuário desconhecido"}),m.update(t,c),console.log("Remessa atualizada com sucesso no Firestore.")})}p.success("Cheque atualizado com sucesso!"),L(!1),console.log("Processo concluído com sucesso.")}catch(o){console.error("Erro ao atualizar cheque:",o),p.error(o.message||"Ocorreu um erro ao atualizar o cheque.")}finally{console.log("Finalizando processo de atualização."),w(!1)}},k=async()=>{if(a&&window.confirm("Tem certeza de que deseja excluir este cheque?")){S(!0);try{if(a.anexoUrl){const s=v(q,a.anexoUrl);await z(s)}const o=j(h,"cheques",d);if(await le(o),a.remessaId){const s=j(h,"remessas",a.remessaId);await O(h,async t=>{const m=await t.get(s);if(!m.exists()){alert("Remessa não encontrada."),y("/cheques");return}const u=m.data();u.cheques=u.cheques.filter(c=>c.id!==d),u.log||(u.log=[]),u.log.push({timestamp:C.now(),message:`Cheque ${a.numeroCheque} excluído`,user:(r==null?void 0:r.displayName)||(r==null?void 0:r.email)||"Usuário desconhecido"}),t.update(s,u)})}p.success("Cheque excluído com sucesso!"),y("/cheques")}catch(o){console.error("Erro ao excluir cheque:",o),p.error(o.message||"Ocorreu um erro ao excluir o cheque.")}finally{S(!1)}}},V=o=>{const s=o.target.value.replace(/\D/g,""),t=s.slice(12,17);l("numeroCheque",t),l("leitora",s)};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(ce,{}),T?e.jsx("p",{children:"Carregando..."}):a?e.jsxs("div",{children:[e.jsx(ue,{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(N,{children:e.jsx(I,{href:"/",children:"Dashboard"})}),e.jsx(B,{}),e.jsx(N,{children:e.jsx(I,{href:"/cheques",children:"Lista de cheques"})}),e.jsx(B,{}),e.jsx(N,{children:e.jsxs(xe,{children:["Detalhes do cheque: ",a.numeroCheque]})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4 text-zinc-800 dark:text-white",children:["Detalhes do Cheque: ",a.numeroCheque]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(_,{open:U,onOpenChange:L,children:[e.jsx(X,{asChild:!0,children:e.jsx(g,{children:"Editar Cheque"})}),e.jsxs(Y,{side:"top",className:"p-4",children:[e.jsxs(Z,{children:[e.jsx(G,{children:"Editar Cheque"}),e.jsx(K,{children:"Atualize as informações do cheque conforme necessário."})]}),e.jsx(E,{className:"h-[70vh]",children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(n,{type:"text",id:"leitora",value:a.leitora,onChange:o=>V(o),placeholder:"Leitora"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(n,{type:"text",id:"numeroCheque",value:a.numeroCheque,onChange:o=>l("numeroCheque",o.target.value),placeholder:"Número do Cheque"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"nome",children:"Nome *"}),e.jsx(n,{type:"text",id:"nome",value:a.nome,onChange:o=>{o.target.value=o.target.value.toUpperCase(),l("nome",o.target.value)},placeholder:"Nome"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(n,{type:"text",id:"cpf",value:a.cpf,onChange:o=>l("cpf",o.target.value),placeholder:"CPF/CNPJ"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"valor",children:"Valor *"}),e.jsx(n,{type:"number",id:"valor",value:a.valor,onChange:o=>l("valor",Number(o.target.value)),placeholder:"Valor"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(pe,{value:a.motivoDevolucao,onValueChange:o=>l("motivoDevolucao",o),children:[e.jsx(je,{children:e.jsx(fe,{placeholder:"Motivo da devolução"})}),e.jsx(ge,{children:ve.map(o=>e.jsx(qe,{value:`${o.classificacao} - ${o.motivo}`,children:e.jsx(W,{children:e.jsxs(ee,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs("span",{children:[o.classificacao," -  ",o.motivo]})}),o.descricao&&e.jsx(oe,{children:o.descricao})]})})},o.classificacao))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(n,{type:"text",id:"numeroOperacao",value:a.numeroOperacao,onChange:o=>l("numeroOperacao",o.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"banco",children:"Banco *"}),e.jsx(n,{type:"text",id:"banco",value:a.banco,onChange:o=>l("banco",o.target.value),placeholder:"Banco"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"vencimento",children:"Vencimento do Cheque *"}),e.jsx(n,{type:"date",id:"vencimento",value:a.vencimento,onChange:o=>l("vencimento",o.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"regiao",children:"Região *"}),e.jsx(n,{type:"text",id:"regiao",value:a.regiao,onChange:o=>l("regiao",o.target.value),placeholder:"Região"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"local",children:"Local *"}),e.jsx(n,{type:"text",id:"local",value:a.local,onChange:o=>l("local",o.target.value),placeholder:"Local"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(n,{type:"file",id:"anexoFile",onChange:o=>l("anexoFile",o.target.files?o.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"}),a.anexoUrl&&e.jsxs("p",{className:"mt-2",children:["Anexo atual:"," ",e.jsx("a",{href:a.anexoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(n,{type:"text",id:"quemRetirou",value:a.quemRetirou,onChange:o=>l("quemRetirou",o.target.value),placeholder:"Nome do responsável"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(n,{type:"date",id:"dataRetirada",value:a.dataRetirada,onChange:o=>l("dataRetirada",o.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsxs(g,{variant:"destructive",onClick:k,disabled:F,children:[F?"Excluindo...":"Excluir Cheque",e.jsx(Ce,{className:"w-4 h-4 ml-2"})]}),e.jsx(g,{onClick:P,disabled:b,children:b?"Atualizando...":"Salvar Alterações"})]})]})})]})]})})]}),e.jsx(de,{className:"w-full",children:e.jsxs(me,{className:"px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Leitora"}),e.jsx("p",{className:"font-medium",children:a.leitora})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Número do Cheque"}),e.jsx("p",{className:"font-medium",children:a.numeroCheque})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nome"}),e.jsx("p",{className:"font-medium",children:a.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"CPF/CNPJ"}),e.jsx("p",{className:"font-medium",children:a.cpf})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Valor"}),e.jsx("p",{className:"font-medium",children:a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Motivo da Devolução"}),e.jsx("p",{className:"font-medium",children:a.motivoDevolucao})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Número da Operação"}),e.jsx("p",{className:"font-medium",children:a.numeroOperacao})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Quem Retirou"}),e.jsx("p",{className:"font-medium",children:a.quemRetirou})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Data da Retirada"}),e.jsx("p",{className:"font-medium",children:a.dataRetirada})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Local"}),e.jsx("p",{className:"font-medium",children:a.local})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Região"}),e.jsx("p",{className:"font-medium",children:a.regiao||"Não definido"})]})]}),a.anexoUrl&&e.jsx("div",{className:"mt-6",children:e.jsx(g,{variant:"outline",className:"w-full",children:e.jsxs("a",{href:a.anexoUrl,className:"w-full flex justify-center gap-2 items-center",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ye,{className:"h-4 w-4"}),"Visualizar Anexo"]})})})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Log de Atividades"}),a.log&&a.log.length>0?e.jsx(E,{className:"space-y-4 h-[300px]",children:a.log.sort((o,s)=>s.timestamp.seconds-o.timestamp.seconds).map((o,s)=>e.jsxs("div",{className:"w-full border-b p-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Por ",o.user," às ",Ne(o.timestamp.toDate(),"dd/MM/yyyy HH:mm:ss")]}),e.jsx("p",{children:o.message})]},s))}):e.jsx("p",{children:"Nenhuma atividade registrada."})]})]}):e.jsx("p",{children:"Cheque não encontrado."})]})};export{Ie as default};
