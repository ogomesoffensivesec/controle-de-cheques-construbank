import{c as M,a1 as H,i as J,r as h,X as Q,j as e,a2 as _,a3 as X,B as j,a4 as Y,a5 as Z,a6 as G,a7 as K,L as l,I as n,Y as W,Z as ee,_ as ae,$ as se,a8 as p,e as m,a9 as re,q as g,t as q,aa as O,ab as oe,ac as te,T as C,ad as B,ae as ie,v as le,w as ne}from"./index-1L3QXtjl.js";import{Q as ce,B as x}from"./ReactToastify-CoRJ3_DZ.js";import{C as de,c as ue}from"./card-DBrxmjLL.js";import{B as me,a as he,b as N,c as I,d as E,e as xe}from"./breadcrumb-DSX5xbwg.js";import{S as T}from"./scroll-area-DxNCeqEf.js";import{S as pe,a as je,b as fe,c as ve,d as ge,e as qe,T as Ce}from"./cheques-BKTdtoZw.js";import{k as Ne}from"./format-CphUbbWy.js";import"./chevron-right-DkwqzOMG.js";import"./check-7Du4jFlM.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=M("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ie=()=>{const{id:f}=H(),y=J(),[a,R]=h.useState(null),[z,D]=h.useState(!0),[b,w]=h.useState(!1),[S,F]=h.useState(!1),[U,L]=h.useState(!1),{currentUser:o}=Q();h.useEffect(()=>{(async()=>{if(f){D(!0);try{const r=p(m,"cheques",f),t=await re(r);if(t.exists()){const c=t.data();R({...c,regiao:c.regiao||"Não definido"})}else x.error("Cheque não encontrado.")}catch(r){console.error("Erro ao buscar cheque:",r),x.error("Ocorreu um erro ao buscar o cheque.")}finally{D(!1)}}})()},[f]);const i=(s,r)=>{a&&R(t=>t&&{...t,[s]:r})},A=async s=>{if(!a||!a.id)return"";const r=g(q,`cheques/anexos/${a.id}/${s.name}`),t=await le(r,s);return await ne(t.ref)},P=async()=>{if(!(!a||!a.id)){w(!0);try{let s=a.anexoUrl;if(a.anexoFile){if(a.anexoUrl){const t=g(q,a.anexoUrl);await O(t)}s=await A(a.anexoFile)}const r=p(m,"cheques",a.id);if(await oe(r,{leitora:a.leitora,numeroCheque:a.numeroCheque,nome:a.nome,cpf:a.cpf,valor:a.valor,motivoDevolucao:a.motivoDevolucao,numeroOperacao:a.numeroOperacao,anexoUrl:s,quemRetirou:a.quemRetirou,dataRetirada:a.dataRetirada,regiao:a.regiao,log:te({timestamp:C.now(),message:"Cheque atualizado",user:(o==null?void 0:o.displayName)||(o==null?void 0:o.email)||"Usuário desconhecido"})}),a.remessaId){const t=p(m,"remessas",a.remessaId);await B(m,async c=>{const d=await c.get(t);if(!d.exists())throw new Error("Remessa não encontrada.");const u=d.data(),v=u.cheques.findIndex($=>$.id===a.id);if(v===-1)throw new Error("Cheque não encontrado na remessa.");u.cheques[v]={...u.cheques[v],leitora:a.leitora,numeroCheque:a.numeroCheque,nome:a.nome,cpf:a.cpf,valor:a.valor,motivoDevolucao:a.motivoDevolucao,numeroOperacao:a.numeroOperacao,anexoUrl:a.anexoUrl,quemRetirou:a.quemRetirou,dataRetirada:a.dataRetirada,regiao:a.regiao},u.log||(u.log=[]),u.log.push({timestamp:C.now(),message:`Cheque ${a.numeroCheque} atualizado`,user:(o==null?void 0:o.displayName)||(o==null?void 0:o.email)||"Usuário desconhecido"}),c.update(t,u)})}x.success("Cheque atualizado com sucesso!"),L(!1)}catch(s){console.error("Erro ao atualizar cheque:",s),x.error(s.message||"Ocorreu um erro ao atualizar o cheque.")}finally{w(!1)}}},k=async()=>{if(!(!a||!a.id)&&window.confirm("Tem certeza de que deseja excluir este cheque?")){F(!0);try{if(a.anexoUrl){const r=g(q,a.anexoUrl);await O(r)}const s=p(m,"cheques",a.id);if(await ie(s),a.remessaId){const r=p(m,"remessas",a.remessaId);await B(m,async t=>{const c=await t.get(r);if(!c.exists()){alert("Remessa não encontrada."),y("/cheques");return}const d=c.data();d.cheques=d.cheques.filter(u=>u.id!==a.id),d.log||(d.log=[]),d.log.push({timestamp:C.now(),message:`Cheque ${a.numeroCheque} excluído`,user:(o==null?void 0:o.displayName)||(o==null?void 0:o.email)||"Usuário desconhecido"}),t.update(r,d)})}x.success("Cheque excluído com sucesso!"),y("/cheques")}catch(s){console.error("Erro ao excluir cheque:",s),x.error(s.message||"Ocorreu um erro ao excluir o cheque.")}finally{F(!1)}}},V=s=>{const r=s.target.value.replace(/\D/g,""),t=r.slice(12,17);i("numeroCheque",t),i("leitora",r)};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(ce,{}),z?e.jsx("p",{children:"Carregando..."}):a?e.jsxs("div",{children:[e.jsx(me,{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(N,{children:e.jsx(I,{href:"/",children:"Dashboard"})}),e.jsx(E,{}),e.jsx(N,{children:e.jsx(I,{href:"/cheques",children:"Lista de cheques"})}),e.jsx(E,{}),e.jsx(N,{children:e.jsxs(xe,{children:["Detalhes do cheque: ",a.numeroCheque]})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4 text-zinc-800 dark:text-white",children:["Detalhes do Cheque: ",a.numeroCheque]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(_,{open:U,onOpenChange:L,children:[e.jsx(X,{asChild:!0,children:e.jsx(j,{children:"Editar Cheque"})}),e.jsxs(Y,{side:"top",className:"p-4",children:[e.jsxs(Z,{children:[e.jsx(G,{children:"Editar Cheque"}),e.jsx(K,{children:"Atualize as informações do cheque conforme necessário."})]}),e.jsx(T,{className:"h-[70vh]",children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(n,{type:"text",id:"leitora",value:a.leitora,onChange:s=>V(s),placeholder:"Leitora",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(n,{type:"text",id:"numeroCheque",value:a.numeroCheque,onChange:s=>i("numeroCheque",s.target.value),placeholder:"Número do Cheque",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"nome",children:"Nome *"}),e.jsx(n,{type:"text",id:"nome",value:a.nome,onChange:s=>{s.target.value=s.target.value.toUpperCase(),i("nome",s.target.value)},placeholder:"Nome",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(n,{type:"text",id:"cpf",value:a.cpf,onChange:s=>i("cpf",s.target.value),placeholder:"CPF/CNPJ",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"valor",children:"Valor *"}),e.jsx(n,{type:"number",id:"valor",value:a.valor,onChange:s=>i("valor",Number(s.target.value)),placeholder:"Valor",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(pe,{value:a.motivoDevolucao,onValueChange:s=>i("motivoDevolucao",s),children:[e.jsx(je,{children:e.jsx(fe,{placeholder:"Motivo da devolução"})}),e.jsx(ve,{children:ge.map(s=>e.jsx(qe,{value:`${s.classificacao} - ${s.motivo}`,children:e.jsx(W,{children:e.jsxs(ee,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs("span",{children:[s.classificacao," -  ",s.motivo]})}),s.descricao&&e.jsx(se,{children:s.descricao})]})})},s.classificacao))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(n,{type:"text",id:"numeroOperacao",value:a.numeroOperacao,onChange:s=>i("numeroOperacao",s.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"banco",children:"Banco *"}),e.jsx(n,{type:"text",id:"banco",value:a.banco,onChange:s=>i("banco",s.target.value),placeholder:"Banco",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vencimento",children:"Vencimento do Cheque *"}),e.jsx(n,{type:"date",id:"vencimento",value:a.vencimento,onChange:s=>i("vencimento",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"regiao",children:"Região *"}),e.jsx(n,{type:"text",id:"regiao",value:a.regiao,onChange:s=>i("regiao",s.target.value),placeholder:"Região",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"local",children:"Local *"}),e.jsx(n,{type:"text",id:"local",value:a.local,onChange:s=>i("local",s.target.value),placeholder:"Local",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(n,{type:"file",id:"anexoFile",onChange:s=>i("anexoFile",s.target.files?s.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"}),a.anexoUrl&&e.jsxs("p",{className:"mt-2",children:["Anexo atual:"," ",e.jsx("a",{href:a.anexoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(n,{type:"text",id:"quemRetirou",value:a.quemRetirou,onChange:s=>i("quemRetirou",s.target.value),placeholder:"Nome do responsável",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(n,{type:"date",id:"dataRetirada",value:a.dataRetirada,onChange:s=>i("dataRetirada",s.target.value),required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsxs(j,{variant:"destructive",onClick:k,disabled:S,children:[S?"Excluindo...":"Excluir Cheque",e.jsx(Ce,{className:"w-4 h-4 ml-2"})]}),e.jsx(j,{onClick:P,disabled:b,children:b?"Atualizando...":"Salvar Alterações"})]})]})})]})]})})]}),e.jsx(de,{className:"w-full",children:e.jsxs(ue,{className:"px-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Leitora"}),e.jsx("p",{className:"font-medium",children:a.leitora})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Número do Cheque"}),e.jsx("p",{className:"font-medium",children:a.numeroCheque})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nome"}),e.jsx("p",{className:"font-medium",children:a.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"CPF/CNPJ"}),e.jsx("p",{className:"font-medium",children:a.cpf})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Valor"}),e.jsx("p",{className:"font-medium",children:a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Motivo da Devolução"}),e.jsx("p",{className:"font-medium",children:a.motivoDevolucao})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Número da Operação"}),e.jsx("p",{className:"font-medium",children:a.numeroOperacao})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Quem Retirou"}),e.jsx("p",{className:"font-medium",children:a.quemRetirou})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Data da Retirada"}),e.jsx("p",{className:"font-medium",children:a.dataRetirada})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Local"}),e.jsx("p",{className:"font-medium",children:a.local})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Região"}),e.jsx("p",{className:"font-medium",children:a.regiao||"Não definido"})]})]}),a.anexoUrl&&e.jsx("div",{className:"mt-6",children:e.jsx(j,{variant:"outline",className:"w-full",children:e.jsxs("a",{href:a.anexoUrl,className:"w-full flex justify-center gap-2 items-center",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ye,{className:"h-4 w-4"}),"Visualizar Anexo"]})})})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Log de Atividades"}),a.log&&a.log.length>0?e.jsx(T,{className:"space-y-4 h-[300px]",children:a.log.sort((s,r)=>r.timestamp.seconds-s.timestamp.seconds).map((s,r)=>e.jsxs("div",{className:"w-full border-b p-2",children:[e.jsxs("p",{className:"text-xs text-gray-500 ",children:["Por ",s.user," às ",Ne(s.timestamp.toDate(),"dd/MM/yyyy HH:mm:ss")]}),e.jsx("p",{children:s.message})]},r))}):e.jsx("p",{children:"Nenhuma atividade registrada."})]})]}):e.jsx("p",{children:"Cheque não encontrado."})]})};export{Ie as default};
