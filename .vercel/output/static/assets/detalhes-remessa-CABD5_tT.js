import{c as xe,aj as pe,u as je,s as fe,r as f,a6 as $,j as e,Q as ge,B as C,L as u,I as h,ae as ve,af as Ce,ag as Ne,ah as ye,ad as Re,ar as P,l as F,as as De,n as g,D as B,E as V,F as Y,G as H,au as z,av as k,T as A,k as qe,ai as be}from"./index-bemzWiEF.js";import{T as Fe,a as we,b as Z,c as N,d as Te,e as y}from"./table-Bs0-gs75.js";import{D as W,f as _,a as J,b as Q,c as G,d as K}from"./dialog-FjYmIpBA.js";import{S as Se}from"./scroll-area-DIAXR4Ub.js";import{S as Pe,a as ze,b as Ae,c as Ie,d as Le,e as Oe}from"./cheques-d5PCEOX-.js";import{t as X,o as se,p as re,c as ke,k as ee}from"./format-CphUbbWy.js";import{P as Ue}from"./pen-xPHDaYys.js";import"./index-CL9-UuGV.js";import"./check-BQ99PCGz.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=xe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function ae(o,s){const n=()=>ke(s==null?void 0:s.in,NaN),i=Ve(o);let x;if(i.date){const d=Ye(i.date,2);x=He(d.restDateString,d.year)}if(!x||isNaN(+x))return n();const v=+x;let p=0,j;if(i.time&&(p=Ze(i.time),isNaN(p)))return n();if(i.timezone){if(j=We(i.timezone),isNaN(j))return n()}else{const d=new Date(v+p),q=X(0,s==null?void 0:s.in);return q.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),q.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),q}return X(v+p+j,s==null?void 0:s.in)}const I={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Me=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,$e=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Be=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ve(o){const s={},n=o.split(I.dateTimeDelimiter);let r;if(n.length>2)return s;if(/:/.test(n[0])?r=n[0]:(s.date=n[0],r=n[1],I.timeZoneDelimiter.test(s.date)&&(s.date=o.split(I.timeZoneDelimiter)[0],r=o.substr(s.date.length,o.length))),r){const i=I.timezone.exec(r);i?(s.time=r.replace(i[1],""),s.timezone=i[1]):s.time=r}return s}function Ye(o,s){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),r=o.match(n);if(!r)return{year:NaN,restDateString:""};const i=r[1]?parseInt(r[1]):null,x=r[2]?parseInt(r[2]):null;return{year:x===null?i:x*100,restDateString:o.slice((r[1]||r[2]).length)}}function He(o,s){if(s===null)return new Date(NaN);const n=o.match(Me);if(!n)return new Date(NaN);const r=!!n[4],i=w(n[1]),x=w(n[2])-1,v=w(n[3]),p=w(n[4]),j=w(n[5])-1;if(r)return Ke(s,p,j)?_e(s,p,j):new Date(NaN);{const d=new Date(0);return!Qe(s,x,v)||!Ge(s,i)?new Date(NaN):(d.setUTCFullYear(s,x,Math.max(i,v)),d)}}function w(o){return o?parseInt(o):1}function Ze(o){const s=o.match($e);if(!s)return NaN;const n=U(s[1]),r=U(s[2]),i=U(s[3]);return Xe(n,r,i)?n*se+r*re+i*1e3:NaN}function U(o){return o&&parseFloat(o.replace(",","."))||0}function We(o){if(o==="Z")return 0;const s=o.match(Be);if(!s)return 0;const n=s[1]==="+"?-1:1,r=parseInt(s[2]),i=s[3]&&parseInt(s[3])||0;return ea(r,i)?n*(r*se+i*re):NaN}function _e(o,s,n){const r=new Date(0);r.setUTCFullYear(o,0,4);const i=r.getUTCDay()||7,x=(s-1)*7+n+1-i;return r.setUTCDate(r.getUTCDate()+x),r}const Je=[31,null,31,30,31,30,31,31,30,31,30,31];function te(o){return o%400===0||o%4===0&&o%100!==0}function Qe(o,s,n){return s>=0&&s<=11&&n>=1&&n<=(Je[s]||(te(o)?29:28))}function Ge(o,s){return s>=1&&s<=(te(o)?366:365)}function Ke(o,s,n){return s>=1&&s<=53&&n>=0&&n<=6}function Xe(o,s,n){return o===24?s===0&&n===0:n>=0&&n<60&&s>=0&&s<60&&o>=0&&o<25}function ea(o,s){return s>=0&&s<=59}const da=()=>{const{id:o}=pe(),{currentUser:s}=je(),n=fe(),[r,i]=f.useState(null),[x,v]=f.useState(!0),[p,j]=f.useState(!1),[d,q]=f.useState(null),[L,oe]=f.useState(""),[b,T]=f.useState([]),[l,O]=f.useState({id:$(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""}),[E,M]=f.useState(!1);f.useEffect(()=>{s.isClient&&n("/"),(async()=>{if(o){v(!0);try{const t=P(F,"remessas",o),c=await De(t);c.exists()?i({id:c.id,...c.data()}):g.error("Remessa não encontrada.")}catch(t){console.error("Erro ao buscar remessa:",t),g.error("Ocorreu um erro ao buscar a remessa.")}finally{v(!1)}}})()},[o]);const ne=async()=>{if(!(!r||!r.id)){if(!d||!L){g.error("Por favor, preencha todos os campos.");return}j(!0);try{const a=B(V,`remessas/${r.id}/${d.name}`);await Y(a,d);const t=await H(a),c=P(F,"remessas",r.id);await z(c,{documentoAssinadoUrl:t,recebidoPor:L,status:"Finalizada",log:k({timestamp:A.now(),message:"Remessa finalizada",user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"})});for(const R of r.cheques){const D=P(F,"cheques",R.id);await z(D,{local:"Destino Final",log:k({timestamp:A.now(),message:`Remessa ${r.protocolo} finalizada`,user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"})})}g.success("Remessa finalizada com sucesso!"),n("/remessas")}catch(a){console.error("Erro ao finalizar remessa:",a),g.error("Ocorreu um erro ao finalizar a remessa.")}finally{j(!1)}}},ie=a=>{const t=a.target.value.replace(/\D/g,""),c=t.slice(12,17);m("numeroCheque",c),m("leitora",t)},m=(a,t)=>{O(c=>({...c,[a]:t}))},le=()=>{if(!l.leitora||!l.numeroCheque||!l.nome||!l.cpf||!l.valor||!l.quemRetirou||!l.dataRetirada||!l.banco){g.error("Por favor, preencha todos os campos obrigatórios.");return}const a={...l,regiao:l.regiao.trim()===""?"Não definido":l.regiao.trim()};E?(T(t=>t.map(c=>c.id===a.id?a:c)),M(!1)):T(t=>[...t,a]),O({id:$(),leitora:"",numeroCheque:"",nome:"",cpf:"",valor:0,motivoDevolucao:"",numeroOperacao:"",anexoFile:null,quemRetirou:"",dataRetirada:"",local:"Escritório",banco:"",vencimento:"",regiao:"",log:[],clientId:""})},ce=a=>{const t=b.find(c=>c.id===a);t&&(O(t),M(!0))},de=a=>{T(t=>t.filter(c=>c.id!==a))},ue=async(a,t)=>{const c=B(V,`cheques/anexos/${t}/${a.name}`),R=await Y(c,a);return await H(R.ref)},me=async()=>{if(!(!r||!r.id)){if(j(!0),b.length===0){g.error("Adicione pelo menos um cheque antes de salvar."),j(!1);return}try{const a=qe(F,"cheques");for(const t of b){let c="";t.anexoFile&&(c=await ue(t.anexoFile,t.id));const R=await be(a,{leitora:t.leitora,numeroCheque:t.numeroCheque,nome:t.nome,cpf:t.cpf,valor:t.valor,motivoDevolucao:t.motivoDevolucao,numeroOperacao:t.numeroOperacao,anexoUrl:c,quemRetirou:t.quemRetirou,dataRetirada:t.dataRetirada,local:`Remessa ${r.protocolo}`,createdAt:A.now(),banco:t.banco,vencimento:t.vencimento,regiao:t.regiao,log:[{timestamp:A.now(),message:"Cheque adicionado à remessa",user:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"Usuário desconhecido"}]}),D=R.id;await z(R,{id:D});const he=P(F,"remessas",r.id);await z(he,{cheques:k({id:D,numeroCheque:t.numeroCheque,banco:t.banco,vencimento:t.vencimento,nome:t.nome,valor:t.valor,regiao:t.regiao})}),i(S=>S&&{...S,cheques:S.cheques.concat({id:D,numeroCheque:t.numeroCheque,banco:t.banco,vencimento:t.vencimento,nome:t.nome,valor:t.valor,regiao:t.regiao,leitora:t.leitora,cpf:t.cpf,quemRetirou:t.quemRetirou,dataRetirada:t.dataRetirada,clientId:t.clientId,local:`Remessa ${r.protocolo}`})})}T([]),g.success("Cheques adicionados à remessa com sucesso!")}catch(a){console.error("Erro ao adicionar cheques:",a),g.error("Ocorreu um erro ao adicionar os cheques.")}finally{j(!1)}}};return e.jsxs("div",{className:"w-full min-h-screen p-4 space-y-6",children:[e.jsx(ge,{}),x?e.jsx("p",{children:"Carregando..."}):r?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold dark:text-white",children:"Detalhes da Remessa"}),e.jsx(C,{onClick:()=>n("/remessas"),children:"Voltar para Remessas"})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Protocolo:"})," ",r.protocolo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data da Remessa:"})," ",r.dataRemessa?ee(typeof r.dataRemessa=="string"?ae(r.dataRemessa):r.dataRemessa,"dd/MM/yyyy"):"Data não disponível"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Emitido por:"})," ",r.emitidoPor]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),r.recebidoPor&&e.jsxs("p",{children:[e.jsx("strong",{children:"Recebido por:"})," ",r.recebidoPor]}),r.documentoPdfUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento PDF:"})," ",e.jsx("a",{href:r.documentoPdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Download"})]}),r.documentoAssinadoUrl&&e.jsxs("p",{children:[e.jsx("strong",{children:"Documento Assinado:"})," ",e.jsx("a",{href:r.documentoAssinadoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"Visualizar"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques na Remessa"}),r.status!=="Finalizada"&&e.jsxs(W,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(C,{variant:"outline",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Adicionar Cheque"]})}),e.jsxs(J,{className:"max-w-6xl",children:[e.jsxs(Q,{children:[e.jsx(G,{children:"Adicionar Cheque"}),e.jsx(K,{children:"Preencha as informações abaixo para adicionar um novo cheque à remessa."})]}),e.jsx(Se,{className:"h-[400px] ",children:e.jsxs("div",{className:"space-y-1.5 pr-6 ",children:[e.jsxs("div",{className:"space-y-1 pr-2  ",children:[e.jsx(u,{htmlFor:"leitora",children:"Leitora *"}),e.jsx(h,{type:"text",id:"leitora",value:l.leitora,onChange:a=>ie(a),placeholder:"Leitora",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroCheque",children:"Número do Cheque *"}),e.jsx(h,{type:"text",id:"numeroCheque",value:l.numeroCheque,onChange:a=>m("numeroCheque",a.target.value),placeholder:"Número do Cheque",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"nome",children:"Nome *"}),e.jsx(h,{type:"text",id:"nome",value:l.nome,onChange:a=>{a.target.value=a.target.value.toUpperCase(),m("nome",a.target.value)},placeholder:"Nome",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"cpf",children:"CPF/CNPJ *"}),e.jsx(h,{type:"text",id:"cpf",value:l.cpf,onChange:a=>m("cpf",a.target.value),placeholder:"CPF/CNPJ",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"valor",children:"Valor *"}),e.jsx(h,{type:"number",id:"valor",value:l.valor,onChange:a=>m("valor",Number(a.target.value)),placeholder:"Valor",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"motivoDevolucao",children:"Motivo da Devolução"}),e.jsxs(Pe,{value:l.motivoDevolucao,onValueChange:a=>m("motivoDevolucao",a),children:[e.jsx(ve,{children:e.jsxs(Ce,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx("span",{className:"w-full",children:e.jsx(ze,{className:"w-full",children:e.jsx(Ae,{placeholder:"Motivo da devolução"})})})}),l.motivoDevolucao&&e.jsx(ye,{})]})}),e.jsx(Ie,{children:Le.map(a=>e.jsxs(Oe,{value:`${a.classificacao} - ${a.motivo}`,children:[a.classificacao," - ",a.motivo]},a.classificacao))})]})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"numeroOperacao",children:"Número da Operação"}),e.jsx(h,{type:"text",id:"numeroOperacao",value:l.numeroOperacao,onChange:a=>m("numeroOperacao",a.target.value),placeholder:"Número da Operação"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"anexoFile",children:"Anexo do Cheque"}),e.jsx(h,{type:"file",id:"anexoFile",onChange:a=>m("anexoFile",a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png"})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"quemRetirou",children:"Quem Retirou *"}),e.jsx(h,{type:"text",id:"quemRetirou",value:l.quemRetirou,onChange:a=>m("quemRetirou",a.target.value),placeholder:"Nome do responsável",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"dataRetirada",children:"Data da Retirada *"}),e.jsx(h,{type:"date",id:"dataRetirada",value:l.dataRetirada,onChange:a=>m("dataRetirada",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"vencimento",children:"Vencimento do cheque *"}),e.jsx(h,{type:"date",id:"vencimento",value:l.vencimento,onChange:a=>m("vencimento",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"local",children:"Local *"}),e.jsx(h,{type:"text",id:"local",value:l.local,onChange:a=>m("local",a.target.value),placeholder:"Local do Cheque",required:!0,disabled:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"banco",children:"Banco *"}),e.jsx(h,{type:"text",id:"banco",value:l.banco,onChange:a=>m("banco",a.target.value),placeholder:"Banco",required:!0})]}),e.jsxs("div",{className:"space-y-1 pr-2",children:[e.jsx(u,{htmlFor:"regiao",children:"Região *"}),e.jsx(h,{type:"text",id:"regiao",value:l.regiao,onChange:a=>m("regiao",a.target.value),placeholder:"Região",required:!0})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(C,{type:"button",onClick:le,children:E?"Atualizar Cheque":"Adicionar Cheque"}),e.jsx(C,{type:"button",onClick:me,disabled:p,children:p?"Salvando Cheques...":"Salvar Cheques"})]})]})]})]}),b.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cheques a serem adicionados"}),e.jsx("div",{className:"space-y-2",children:b.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Banco:"})," ",a.banco]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leitora:"})," ",a.leitora]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Número do Cheque:"})," ",a.numeroCheque]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",a.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Região:"})," ",a.regiao||"Não definido"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(C,{variant:"outline",onClick:()=>ce(a.id),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(C,{variant:"destructive",onClick:()=>de(a.id),children:e.jsx(Re,{className:"w-4 h-4"})})]})]},a.id))})]}),e.jsx("div",{className:"rounded-md border mt-6",children:e.jsxs(Fe,{children:[e.jsx(we,{children:e.jsxs(Z,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Número do Cheque"}),e.jsx(N,{children:"Banco"}),e.jsx(N,{children:"Vencimento"}),e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Região"})," ",e.jsx(N,{className:"text-right",children:"Valor"})]})}),e.jsx(Te,{children:r.cheques.map((a,t)=>e.jsxs(Z,{children:[e.jsx(y,{children:t+1}),e.jsx(y,{children:a.numeroCheque}),e.jsx(y,{children:a.banco}),e.jsx(y,{children:a.vencimento?ee(ae(a.vencimento),"dd/MM/yyyy"):"Data não disponível"}),e.jsx(y,{children:a.nome}),e.jsx(y,{children:a.regiao||"Não definido"})," ",e.jsx(y,{className:"text-right",children:a.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a.id||t))})]})})]}),r.status!=="Finalizada"&&e.jsx("div",{className:"mt-6",children:e.jsxs(W,{children:[e.jsx(_,{asChild:!0,children:e.jsx(C,{children:"Finalizar Remessa"})}),e.jsxs(J,{children:[e.jsxs(Q,{children:[e.jsx(G,{children:"Finalizar Remessa"}),e.jsx(K,{children:"Preencha as informações abaixo para finalizar a remessa."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"recebidoPor",children:"Recebido por *"}),e.jsx(h,{type:"text",id:"recebidoPor",value:L,onChange:a=>oe(a.target.value),placeholder:"Nome de quem recebeu",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"documentoAssinado",children:"Documento Assinado *"}),e.jsx(h,{type:"file",id:"documentoAssinado",onChange:a=>q(a.target.files?a.target.files[0]:null),accept:".pdf, .jpg, .jpeg, .png",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(C,{onClick:ne,disabled:p,children:p?"Finalizando...":"Finalizar Remessa"})})]})]})]})})]}):e.jsx("p",{children:"Remessa não encontrada."})]})};export{da as default};
